<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Email Validator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5">
  <h1 class="mb-4">Email Validator</h1>

  <form id="uploadForm" class="mb-3">
    <input class="form-control" type="file" name="file" id="fileInput" required>
    <button class="btn btn-primary mt-2" type="submit">Validate Emails</button>
  </form>

  <div id="status" class="alert alert-info d-none">⏳ Processing, please wait...</div>
  <div id="result" class="mt-3 d-none"></div>
</div>

<script>
document.getElementById("uploadForm").addEventListener("submit", async function(e) {
  e.preventDefault();
  const fileInput = document.getElementById("fileInput");
  const statusDiv = document.getElementById("status");
  const resultDiv = document.getElementById("result");

  statusDiv.classList.remove("d-none");
  statusDiv.textContent = "⏳ Processing, please wait...";
  resultDiv.classList.add("d-none");
  resultDiv.innerHTML = "";

  const formData = new FormData();
  formData.append("file", fileInput.files[0]);

  const res = await fetch("/validate", {
    method: "POST",
    body: formData
  });

  const data = await res.json();

  statusDiv.classList.add("d-none");

  if (data.error) {
    resultDiv.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
  } else {
    resultDiv.innerHTML = `
      <div class="alert alert-success">
        ✅ <strong>${data.summary.valid}</strong> valid<br>
        ⚠️ <strong>${data.summary.risky}</strong> risky<br>
        ❌ <strong>${data.summary.invalid}</strong> invalid
      </div>
      <a class="btn btn-success" href="${data.download_url}">Download Validated CSV</a>
    `;
  }

  resultDiv.classList.remove("d-none");
});
</script>
</body>
</html>
